---
  classes:
    - digcolproc
    - global
    - ldap_client
    - proftpd
    - samba::server
  global::environment:
    DIGCOLPROC_HOME: /usr/bin/digcolproc/
    DIGCOLPROC_DEBUG: ""
    LANG: "en_US.UTF-8"
    LANGUAGE: "en_US"
    LC_CTYPE: "en_US.UTF-8"
    LC_NUMERIC: "en_US.UTF-8"
    LC_TIME: "en_US.UTF-8"
    LC_COLLATE: "en_US.UTF-8"
    LC_MONETARY: "en_US.UTF-8"
    LC_MESSAGES: "en_US.UTF-8"
    LC_PAPER: "en_US.UTF-8"
    LC_NAME: "en_US.UTF-8"
    LC_ADDRESS: "en_US.UTF-8"
    LC_TELEPHONE: "en_US.UTF-8"
    LC_MEASUREMENT: "en_US.UTF-8"
    LC_IDENTIFICATION: "en_US.UTF-8"
    LC_ALL: ""
  global::ldap_client: true
  java::vendor: "openjdk"
  samba::server::interfaces: "eth0 lo"
  samba::server::map_to_guest: "Bad user"
  samba::server::pam_password_change: "No"
  samba::server::security: "user"
  samba::server::server_string: "%h server (Samba, Ubuntu)"
  samba::server::obey_pam_restrictions: "No"
  samba::server::unix_password_sync: "Yes"
  samba::server::workgroup: "WORKGROUP"
  tomcat::java_home: "/usr/lib/jvm/java-7-openjdk-amd64/"
  tomcat::java_opts: "-server -Xms1024M -Xmx1024M -Dacquisition.properties=/etc/tomcat7/application.properties -Dloglevel=info -Djavax.net.ssl.trustStorePassword=changeit -Djavax.net.ssl.trustStore=/etc/tomcat7/cacerts"
  tomcat::loglevel: "warning"
  tomcat::properties: 
    dataSource.url: "jdbc:mysql://%{::fqdn}:3306/ad"
    dataSource.username: "ad"
    dataSource.password: "ad"
    grails.plugin.springsecurity.ldap.context.server: "ldap://ds0.socialhistoryservices.org"
    grails.plugin.springsecurity.ldap.context.managerDn: "cn=admin,dc=socialhistoryservices,dc=org"
    grails.plugin.springsecurity.ldap.context.managerPassword: "G3tL0st"
    grails.plugin.springsecurity.ldap.search.base: "ou=users,dc=socialhistoryservices,dc=org"
    grails.mail.host: "mail1.socialhistoryservices.org"
    grails.mail.port: "25"
    grails.mail.username: "digcolproc.mail.agent@socialhistoryservices.org"
    grails.mail.password: "IxGG0mUobqgG3xPl"
    jira.email.address: "gcu@iisg.nl"
    ingestDepot.contentType.fileIdentificationReport: "text/plain"
    ingestDepot.ftp.secure: "true"
    ingestDepot.ftp.isImplicit: "false"
    ingestDepot.ftp.enterLocalPassiveMode: "true"
    ingestDepot.ftp.host: "10.0.0.100"
    ingestDepot.ftp.port: "21"
    ingestDepot.ftp.username: "offloader-flow3-owner"
    ingestDepot.ftp.password: "offloader-flow3-owner"
    grails.serverURL: "https://10.0.0.100"
    role_admin: "kerim,mmu,jzw,gcu"
    role_user: "bhi,hsa,mvh,fdj,jacques.vangerwen,sbe@iisg.nl,job.schouten,zulfikar.ozdogan,rba,eef vermeij,eko,harriets"
    access_token: "my_acquisition_database_access_token"
    # see https://jira.socialhistoryservices.org/browse/DIGCOLPROC-439
    export.default.columns: "id,name,location,content,to_be_done"
  mysql::server::databases:
    ad: 
      ensure: "present"
      charset: "utf8"
  mysql::server::users: 
    ad@%{::fqdn}: 
      ensure: "present"
      password_hash: "*3C4CAC5F9299DA5727380393F02B0E30E12C376F"
    gcu@10.24.66.182: 
      ensure: "present"
      password_hash: "*74B864CF851B0160992F9375F2619597CA55D1EC"
    gcu@10.24.9.%: 
      ensure: "present"
      password_hash: "*74B864CF851B0160992F9375F2619597CA55D1EC"
    gcu@10.24.100.1%: 
      ensure: "present"
      password_hash: "*74B864CF851B0160992F9375F2619597CA55D1EC"
  mysql::server::grants: 
    ad@%{::fqdn}/ad.*: 
      ensure: "present"
      options: "GRANT"
      privileges: 
        - "CREATE"
        - "ALTER"
        - "SELECT"
        - "INDEX"
        - "INSERT"
        - "UPDATE"
        - "DELETE"
      table: "ad.*"
      user: "ad@%{::fqdn}"
    gcu@10.24.66.182/ad.*: 
      ensure: "present"
      options: "GRANT"
      privileges: 
        - "SELECT"
        - "INSERT"
        - "UPDATE"
        - "DELETE"
        - "CREATE"
        - "DROP"
        - "INDEX"
        - "ALTER"
        - "SHOW VIEW"
        - "CREATE VIEW"
        - "EXECUTE"
      table: "ad.*"
      user: "gcu@10.24.66.182"
    gcu@10.24.9.%/ad.*: 
      ensure: "present"
      options: "GRANT"
      privileges: 
        - "SELECT"
        - "INSERT"
        - "UPDATE"
        - "DELETE"
        - "CREATE"
        - "DROP"
        - "INDEX"
        - "ALTER"
        - "SHOW VIEW"
        - "CREATE VIEW"
        - "EXECUTE"
      table: "ad.*"
      user: "gcu@10.24.9.%"
    gcu@10.24.100.1%/ad.*: 
      ensure: "present"
      options: "GRANT"
      privileges: 
        - "SELECT"
        - "INSERT"
        - "UPDATE"
        - "DELETE"
        - "CREATE"
        - "DROP"
        - "INDEX"
        - "ALTER"
        - "SHOW VIEW"
        - "CREATE VIEW"
        - "EXECUTE"
      table: "ad.*"
      user: "gcu@10.24.100.1%"
  ldap_client::nss_base: 
    - "nss_base_passwd ou=offloader,dc=socialhistoryservices,dc=org"
    - "nss_base_shadow ou=offloader,dc=socialhistoryservices,dc=org"
    - "nss_base_passwd ou=stagingarea,dc=socialhistoryservices,dc=org"
    - "nss_base_shadow ou=stagingarea,dc=socialhistoryservices,dc=org"
    - "nss_base_passwd ou=people,dc=socialhistoryservices,dc=org"
    - "nss_base_shadow ou=people,dc=socialhistoryservices,dc=org"
    - "nss_base_group ou=bucket,dc=socialhistoryservices,dc=org"
  proftpd::proxy_fqdn: "10.0.0.100"
  proftpd::proftpd_conf_server_name: "Digcolproc and object repository acceptance server"
  proftpd::proftpd_conf_masquerade_address: "10.24.67.218"
  proftpd::proftpd_conf_passive_ports: "50000 59999"
  digcolproc::flow_config:
    api_upload: "https://api.socialhistoryservices.org/upload/datestamp"
    api_upload_key: "my_api_upload_key"
    environment: "test"
    flow1_hotfolders: "/offloader/flow1/"
    flow1_client: "flow1-acc@%{::fqdn}"
    flow1_access: "open"
    flow1_access_token: "my_flow1_access_token"
    flow1_autoIngestValidInstruction: false
    flow1_deleteCompletedInstruction: false
    flow1_notificationEMail: "jho@iisg.nl;etu@iisg.nl;lwo@iisg.nl"
    flow1_ftp_connection: "ftp://stagingarea-flow1-acc:stagingarea-flow1-acc@10.0.0.100"
    flow2_hotfolders: "/offloader/flow2/"
    flow2_client: "flow2-acc@%{::fqdn}"
    flow2_access: "closed"
    flow2_access_token: "my_flow2_access_token"
    flow2_autoIngestValidInstruction: true
    flow2_deleteCompletedInstruction: false
    flow2_notificationEMail: "lwo@iisg.nl"
    flow2_ftp_connection: "ftp://stagingarea-flow2-acc:stagingarea-flow2-acc@10.0.0.100"
    flow3_hotfolders: "/offloader/flow3/"
    flow3_client: "flow3-acc@%{::fqdn}"
    flow3_access: "closed"
    flow3_access_token: "my_flow3_access_token"
    flow3_autoIngestValidInstruction: false
    flow3_deleteCompletedInstruction: false
    flow3_notificationEMail: "gcu@iisg.nl;lwo@iisg.nl;digcolproc.jira@socialhistoryservices.org"
    flow3_ftp_connection: "ftp://stagingarea-flow3-acc:stagingarea-flow3-acc@10.0.0.100"
    flow5_hotfolders: "/offloader/flow5/"
    flow5_client: "flow5-acc@%{::fqdn}"
    flow5_access: "closed"
    flow5_access_token: "my_flow5_access_token"
    flow5_autoIngestValidInstruction: true
    flow5_deleteCompletedInstruction: false
    flow5_notificationEMail: "edr@iisg.nl"
    flow5_set: "iish.evergreen.biblio"
    flow5_ftp_connection: "ftp://stagingarea-flow5-acc:stagingarea-flow5-acc@10.0.0.100"
    flow14_hotfolders: "/offloader/flow14/"
    flow14_client: "flow4-acc@%{::fqdn}"
    flow14_access: "closed"
    flow14_access_token: "my_flow14_access_token"
    flow14_autoIngestValidInstruction: false
    flow14_deleteCompletedInstruction: false
    flow14_notificationEMail: "edr@iisg.nl"
    flow14_ftp_connection: "ftp://flow14:flow14@10.0.0.100"
    flow_keys: "client autoIngestValidInstruction deleteCompletedInstruction notificationEMail access access_token ftp_connection"
    mail_relay: "mail1.socialhistoryservices.org"
    mail_user: "my_mail_user"
    mail_password: "my_mail_password"
    pidwebserviceEndpoint: "https://pid.socialhistoryservices.org/secure/"
    pidwebserviceKey: "my_pidwebserviceKey"
    catalog: "http://search.socialhistory.org/Record"
    or: "http://disseminate.objectrepository.org"
    oai: "http://api.socialhistoryservices.org/solr/all/oai"
    sru: "http://api.socialhistoryservices.org/solr/all/srw"
    acquisition_database: "https://10.0.0.100"
    acquisition_database_access_token: "my_acquisition_database_access_token"
  resources:
    cron:
      startup:
        ensure: "present"
        user: "root"
        command: "${DIGCOLPROC_HOME}startup.sh"
        minute: "*/1"
      flow4 ingest:
        ensure: "present"
        user: "root"
        command: "${DIGCOLPROC_HOME}util/place_event.sh flow2 ingest.txt"
        minute: "*/1"
      flow3 folders:
        ensure: "present"
        user: "root"
        command: "${DIGCOLPROC_HOME}flows/flow3/api_call/run.sh"
        minute: "*/1"
      flow5 create:
        ensure: "present"
        user: "root"
        command: "${DIGCOLPROC_HOME}flows/startup/run.sh flow5 create.txt system"
        hour: "2"
      flow5 remove:
        ensure: "present"
        user: "root"
        command: "${DIGCOLPROC_HOME}flows/startup/run.sh flow5 remove.txt"
        hour: "23"
        minute: "59"
    exec:
      lxml:
        command: "/usr/bin/pip install lxml"
    file:
      "/var/lib/tomcat7/webapps/ROOT.war":
        ensure: "link"
        target: "/opt/ad/ROOT.war"
      /data/offloader/flow5:
        ensure: directory
      /data/offloader/flow5/10622:
        ensure: directory
      /data/offloader/flow5/10622/offloader-flow5-acc:
        ensure: directory
    package:
      lftp:
        ensure: "present"
      locales:
        ensure: "present"
      libxml2-dev:
        ensure: "present"
      libxslt1-dev:
        ensure: "present"
      python-dev:
        ensure: "present"
    samba::server::share:
      flow1_offloader:
        browsable: true
        comment: "Offload archief materiaal van fabriek"
        create_mask: "0777"
        directory_mask: "0777"
        force_create_mask: "0777"
        force_directory_mask: "0777"
        guest_ok: false
        guest_only: false
        path: "/data/offloader/flow1/10622"
        valid_users: "jho, lwo"
        writable: true
      flow1_evaluator:
        browsable: true
        comment: "Evalueer archief materiaal van fabriek"
        create_mask: "0777"
        directory_mask: "0777"
        force_create_mask: "0777"
        force_directory_mask: "0777"
        guest_ok: false
        guest_only: false
        path: "/data/offloader/flow1/10622"
        valid_users: "etu"
        writable: false
    trigger::add_trigger2:
      digcolproc:
        bamboo_key: "DIGCOLPROC-TEST"
        filename: "digcolproc-1.0.tar.gz"
        bamboo_tag_version: "1.0"
        bamboo_build_version: "latestSuccessful"
        location: "/usr/bin/digcolproc/"
        rsync_exclude: "--exclude='config.sh'"
        schedule_tricker: true
    trigger::add_trigger_war:
      ad:
        bamboo_key: "AD-TEST"
        filename: "ad-1.0.war"
        bamboo_tag_version: "1.0"
        bamboo_build_version: "latestSuccessful"
        location: "/opt/ad/"
        schedule_tricker: true
    trigger::file:
      validation:
        location: "/opt/validation"
        url: "https://bamboo.socialhistoryservices.org/browse/OR-FVAL/latestSuccessful/artifact/JOB1/validation/validation-1.0.jar"
        schedule_trigger: true
